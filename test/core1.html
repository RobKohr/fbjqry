<fb:js-string var="core1FBML">

<div id="main">
    <span id="span1"></span>
    <div>
        <span id="span2"></span>
        <span id="span3"></span>
        <div>
            <span id="span4"></span>
        </div>
    </div>
    <span id="span5"></span>
</div>
<span id="span6"></span>

<form id="form" action="formaction" style="display: none;">
    <input id="check" type="checkbox" name="check-name" value="ON" />
    <input id="radio" type="radio" name="radio-name" value="" checked="checked" />
    <input id="text" type="text" name="text-name" value="TEST" maxlength="10" />
    <textarea id="area" title="Title!" class="text area" name="area-name" cols="6" rows="5" readonly />
    <select id="select" name="select-name">
        <option id="option1">option1</option>
        <option id="option2" selected>option2</option>
        <option id="option3">option3</option>
    </select>
</form>
<a href="http://example.com" id="anchor"></a>

</fb:js-string>

<script type="text/javascript">
    var core1Suite = { suiteName: "core1" };

    core1Suite.setUp = function () {
        document.getRootElement().setInnerFBML(core1FBML);
    };

    core1Suite.testBasicRequirements = function () {
        Asserts.assertNotUndefined(FBjqRY);
        Asserts.assertNotNull(FBjqRY);

        Asserts.assertNotUndefined(jQuery);
        Asserts.assertNotNull(jQuery);

        Asserts.assertNotUndefined($);
        Asserts.assertNotNull($);
    };

    core1Suite.testFBjqRY1 = function () {
        var main = FBjqRY("#main");
        Asserts.assertNotUndefined(main);
        Asserts.assertNotUndefined(main.length);

        Asserts.assertNotUndefined(main.size);
        Asserts.assertTypeOf('function', main.size);
        Asserts.assertEqual(main.length, main.size());

        var spans = FBjqRY("div span", main).get();
        Asserts.assertNotUndefined(spans);
        Asserts.assertTypeOf('number', spans.length); // it's an array
        Asserts.assertTypeOf('function', spans.slice); // it's an array
    };
    core1Suite.testFBjqRY2 = function () {
        var code = jQuery("<code/>");
        Asserts.assertEqual(1, code.length);

        var img = jQuery("<img/>");
        Asserts.assertEqual(1, img.length);

        // NOTE: FBJS only supports XHTML !
        //var div = jQuery("<div/><hr/><code/><b/>");
        //Asserts.assertEqual(4, div.length);

        var div = jQuery("<div><hr/><code/><b/></div>");
        Asserts.assertEqual(1, div.length);
        Asserts.assertTrue(1, div.get(0).getTagName);
        Asserts.assertEqual('DIV', div.get(0).getTagName());
        var divChilds = div.get(0).getChildNodes();
        Asserts.assertEqual(3, divChilds.length);
        Asserts.assertEqual('HR', divChilds[0].getTagName());
        Asserts.assertEqual('CODE', divChilds[1].getTagName());
        Asserts.assertEqual('B', divChilds[2].getTagName());
    };
    core1Suite.testFBjqRY3 = function () {
        Asserts.assertEqual(1, FBjqRY( document ).length);
        Asserts.assertEqual(1, FBjqRY( document.getRootElement() ).length);
        Asserts.assertEqual(3, FBjqRY( [1, 2, 3] ).length);
        Asserts.assertEqual(2, FBjqRY( [1, 2, 3] ).get(1));
    };

    core1Suite.testSelectorState1 = function () {
        var equals = function(actual, expected, message) {
            Asserts.assertEqual(expected, actual, message);
        };
        var test, root = document.getRootElement();

        test = jQuery();
        equals( test.selector, "", "Empty jQuery Selector" );
        equals( test.context, document, "Empty jQuery Context" );

        test = jQuery(root);
        equals( test.selector, "", "Root Selector" );
        equals( test.context, root, "Root Context" );

        test = jQuery("#main");
        equals( test.selector, "#main", "#main Selector" );
        equals( test.context, document, "#main Context" );

        test = jQuery("#notfound");
        equals( test.selector, "#notfound", "#notfound Selector" );
        equals( test.context, document, "#notfound Context" );

        // NOTE: non-sense in FBJS as well as jQuery(document)
        //test = jQuery("#main", document);
        //equals( test.selector, "#main", "#main Selector" );
        //equals( test.context, document, "#main Context" );

        test = jQuery("#main", root);
        equals( test.selector, "#main", "#main Selector" );
        equals( test.context, root, "#main Context" );
    };

    core1Suite.testSelectorState2 = function () {
        var equals = function(actual, expected, message) {
            Asserts.assertEqual(expected, actual, message);
        };
        
        var root = document.getRootElement();
        var test = jQuery("#main", root);
         // Test cloning
        test = jQuery(test);
        equals( test.selector, "#main", "#main Selector" );
        equals( test.context, root, "#main Context" );

        test = jQuery(root).find("#main");
        equals( test.selector, "#main", "#main find Selector" );
        equals( test.context, root, "#main find Context" );

        test = jQuery("#main").filter("div");
        equals( test.selector, "#main.filter(div)", "#main filter Selector" );
        equals( test.context, document, "#main filter Context" );

        test = jQuery("#main").not("div");
        equals( test.selector, "#main.not(div)", "#main not Selector" );
        equals( test.context, document, "#main not Context" );

        test = jQuery("#main").filter("div").not("div");
        equals( test.selector, "#main.filter(div).not(div)", "#main filter, not Selector" );
        equals( test.context, document, "#main filter, not Context" );

        test = jQuery("#main").filter("div").not("div").end();
        equals( test.selector, "#main.filter(div)", "#main filter, not, end Selector" );
        equals( test.context, document, "#main filter, not, end Context" );

        test = jQuery("#main").parent("body");
        equals( test.selector, "#main.parent(body)", "#main parent Selector" );
        equals( test.context, document, "#main parent Context" );

        test = jQuery("#main").eq(0);
        equals( test.selector, "#main.slice(0,1)", "#main eq Selector" );
        equals( test.context, document, "#main eq Context" );
    };

    core1Suite.testIsFunction = function () {
        var ok = function(actual, message) {
            Asserts.assertTrue(actual, message);
        };

        // Make sure that false values return false
        ok( !jQuery.isFunction(), "No Value" );
        ok( !jQuery.isFunction( null ), "null Value" );
        ok( !jQuery.isFunction( undefined ), "undefined Value" );
        ok( !jQuery.isFunction( "" ), "Empty String Value" );
        ok( !jQuery.isFunction( 0 ), "0 Value" );
        ok( !jQuery.isFunction( [] ), "Empty Array" );
        ok( !jQuery.isFunction( {} ), "Empty Object" );

        // When stringified, this could be misinterpreted
        var mystr = "function";
        ok( !jQuery.isFunction(mystr), "Function String" );

        // When stringified, this could be misinterpreted
        var myarr = [ "function" ];
        ok( !jQuery.isFunction(myarr), "Function Array" );

        // When stringified, this could be misinterpreted
        var myfunction = { "function": "test" };
        ok( !jQuery.isFunction(myfunction), "Function Object" );

        // Make sure normal functions still work
        var fn = function(){};
        ok( jQuery.isFunction(fn), "Normal Function" );

        var div = document.createElement("div");
        ok( !jQuery.isFunction(div), "Div Element" );

        var root = document.getRootElement();
        // Normal elements are reported ok everywhere
        ok( !jQuery.isFunction(root), "A normal DOM Element" );

         // Recursive function calls have lengths and array-like properties
        function callme(callback) {
            function fn(response){ callback(response); }

            ok( jQuery.isFunction(fn), "Recursive Function Call" );

            fn({ some: "data" });
        };
        callme(function(){ callme(function(){}); });
    };

    core1Suite.testFBjqRY_HTML = function () {
        var ok = function(actual, message) {
            Asserts.assertTrue(actual, message);
        };

        var input = jQuery("<input/>");
        Asserts.assertEqual(1, input.length);
        Asserts.assertTrue( input.get(0).getTagName );
        Asserts.assertEqual('INPUT', input.get(0).getTagName());
        ok( input.attr("type", "hidden"), "Create an input and set the type." );

        //var j = jQuery("<span>hi</span> there <!-- mon ami -->");
        //ok( j.length >= 2, "Check node,textnode,comment creation (some browsers delete comments)" );

        var p = jQuery("<p id='p1' class='hello world' title='TITEL!'>MEHEHE</p>");
        Asserts.assertEqual(1, p.size());
        Asserts.assertEqual('p1', p.get(0).getId());
        Asserts.assertTrue( p.get(0).hasClassName('hello') );
        Asserts.assertFalse( p.get(0).hasClassName('WoRlD') );
        Asserts.assertTrue( p.get(0).hasClassName('world') );
        Asserts.assertEqual('TITEL!', p.get(0).getTitle());
        // NOTE: we can not test the inner text as there's no getTextValue() in FBJS !
    };

    core1Suite.testFBjqRY_HTMLWithContext = function () {
        var $div = jQuery("<div/>");
        var $span = jQuery("<span/>", $div);
        Asserts.assertEqual(1, $span.length, "Verify a span created with a div context works");
    };

    core1Suite.testLength = function () {
        Asserts.assertEqual( 6, jQuery("span").length, "Get Number of Elements Found" );
    };
    core1Suite.testSize = function () {
        Asserts.assertEqual( 6, jQuery("span").size(), "Get Number of Elements Found" );
    };
    
    core1Suite.testGet = function () {
        var spans = jQuery("span").get();
        Asserts.assertEqual(6, spans.length);
        Asserts.assertEqualNode(document.getElementById('span1'), spans[0]);
        Asserts.assertEqualNode(document.getElementById('span2'), spans[1]);
        Asserts.assertEqualNode(document.getElementById('span3'), spans[2]);
        Asserts.assertEqualNode(document.getElementById('span4'), spans[3]);
        Asserts.assertEqualNode(document.getElementById('span5'), spans[4]);
        Asserts.assertEqualNode(document.getElementById('span6'), spans[5]);
    };
    core1Suite.testGet0 = function () {
        var span = jQuery("span").get(0);
        Asserts.assertTrue(span.getId);
        Asserts.assertEqual('span1', span.getId());
    };

    core1Suite.testEach = function () {
        var div = jQuery("div");
        div.each( function() { this.setTitle('zoo'); } );
        var pass = true;
            for ( var i = 0; i < div.size(); i++ ) {
                if ( div.get(i).getTitle() != "zoo" ) pass = false;
        }
        Asserts.assertTrue(pass, "Execute a function, Relative" );
    };

    core1Suite.testAdd = function () {
        var equals = function(actual, expected, message) {
            Asserts.assertEqual(expected, actual, message);
        };
        
        //isSet( jQuery("#sndp").add("#en").add("#sap").get(), q("sndp", "en", "sap"), "Check elements from document" );
        //isSet( jQuery("#sndp").add( jQuery("#en")[0] ).add( jQuery("#sap") ).get(), q("sndp", "en", "sap"), "Check elements from document" );
        
        //ok( jQuery([]).add(jQuery("#form")[0].elements).length >= 13, "Check elements from array" );

        var x = jQuery([]).add( jQuery("<p id='x1'>xxx</p>") ).add( jQuery("<p id='x2'>xxx</p>") );
        Asserts.assertEqual(2, x.size());
        equals( x.get(0).getId(), "x1", "Check on-the-fly element1" );
        equals( x.get(1).getId(), "x2", "Check on-the-fly element2" );

        var x = jQuery([]).add("<p id='x1'>xxx</p>").add("<p id='x2'>xxx</p>");
        Asserts.assertEqual(2, x.size());
        equals( x.get(0).getId(), "x1", "Check on-the-fly html element1" );
        equals( x.get(1).getId(), "x2", "Check on-the-fly html element2" );

        var notDefined;
        equals( jQuery([]).add(notDefined).length, 0, "Check that undefined adds nothing" );

        // Added after #2811
        //equals( jQuery([]).add([window,document,document.body,document]).length, 3, "Pass an array" );
        //equals( jQuery(document).add(document).length, 1, "Check duplicated elements" );
        //ok( jQuery([]).add( document.getElementById('form') ).length >= 13, "Add a form (adds the elements)" );
    };

    core1Suite.testIndex = function () {
        var equals = function(actual, expected, message) {
            Asserts.assertEqual(expected, actual, message);
        };
        
        var elements = jQuery([ document.getRootElement(), document.getElementById('main') ]),
        spanElements = jQuery('#span1,#span2,#span6,#span5');

        equals( elements.index( document.getRootElement() ), 0, "Check for index of elements" );
        equals( elements.index( document.getElementById('main') ), 1, "Check for index of elements" );
        
        equals( spanElements.index( document.getElementById('span1') ), 0, "Check for index of elements" );
        equals( spanElements.index( document.getElementById('span2') ), 1, "Check for index of elements" );
        equals( spanElements.index( document.getElementById('span6') ), 2, "Check for index of elements" );
        equals( spanElements.index( document.getElementById('span5') ), 3, "Check for index of elements" );
        equals( spanElements.index( document.getElementById('span3') ), -1, "Check for index of elements" );
        equals( spanElements.index( document.getElementById('span4') ), -1, "Check for index of elements" );

        equals( spanElements.index( document.getRootElement() ), -1, "Check for not found index" );
        equals( spanElements.index( document.getElementById('main') ), -1, "Check for not found index" );
        equals( spanElements.index( document ), -1, "Check for not found index" );

        // enabled since [5500]
        equals( elements.index( elements ), 0, "Pass in a jQuery object" );
        equals( elements.index( elements.eq(1) ), 1, "Pass in a jQuery object" );
    };

    core1Suite.testAttr1 = function () {
        var equals = function(actual, expected, message) {
            Asserts.assertEqual(expected, actual, message);
        };
        var ok = function(actual, message) {
            Asserts.assertTrue(actual, message);
        };

        equals( jQuery('#text').attr('value'), "TEST", 'Check for value attribute' );
        var j = jQuery('#text');
        Asserts.assertIdentical( j.attr('value', 'TEST'), j, 'Check value setter returns jQuery object' );
        // @todo support defaultValue ?!
        //equals( jQuery('#text').attr('value', "Test2").attr('defaultValue'), "Test", 'Check for defaultValue attribute' );
        equals( jQuery('#text').attr('type'), "text", 'Check for type attribute' );
        equals( jQuery('#radio').attr('type'), "radio", 'Check for type attribute' );
        equals( jQuery('#check').attr('type'), "checkbox", 'Check for type attribute' );
        equals( jQuery('#check').attr('value'), "ON", 'Check for value attribute' );

        equals( jQuery('#area').attr('title'), "Title!", 'Check for title attribute' );
        equals( jQuery('#area').attr('readonly'), true, 'Check for readonly attribute' );
        equals( jQuery('#text').attr('readonly'), false, 'Check for readonly attribute' );
        equals( jQuery('#area').attr('class'), "text area", 'Check for class attribute' );
        equals( jQuery('#text').attr('name'), "text-name", 'Check for name attribute' );
        //equals( jQuery('#form').attr('action'), "formaction", 'Check for action attribute' );
        ok( jQuery('#form').attr('action').indexOf("formaction") >= 0, 'Check for action attribute' );

        equals( jQuery("<option/>").attr("selected"), false, "Check selected attribute on disconnected element." );

        equals( jQuery('#option1').attr('selected'), false, 'Check for selected attribute' );
        equals( jQuery('#option2').attr('selected'), true, 'Check for selected attribute' );
        equals( jQuery('#select').attr('selectedIndex'), 1, 'Check for selectedIndex attribute' );

        var select = document.getElementById('select');
        select.setSelectedIndex(2);
        equals( jQuery('#option2').attr('selected'), false, 'Check for selected attribute' );
        equals( jQuery('#option3').attr('selected'), true, 'Check for selected attribute' );
        equals( jQuery('#select').attr('selectedIndex'), 2, 'Check for selectedIndex attribute' );

        jQuery('#select').attr('selectedIndex', 0);
        equals( jQuery('#option1').attr('selected'), true, 'Check for selected attribute' );

        // Related to [5574] and [5683]
//        var body = document.body, $body = jQuery(body);
//
//        ok( $body.attr('foo') === undefined, 'Make sure that a non existent attribute returns undefined' );
//        ok( $body.attr('nextSibling') === null, 'Make sure a null expando returns null' );
//
//        body.setAttribute('foo', 'baz');
//        equals( $body.attr('foo'), 'baz', 'Make sure the dom attribute is retrieved when no expando is found' );
//
//        body.foo = 'bar';
//        equals( $body.attr('foo'), 'bar', 'Make sure the expando is preferred over the dom attribute' );
//
//        $body.attr('foo','cool');
//        equals( $body.attr('foo'), 'cool', 'Make sure that setting works well when both expando and dom attribute are available' );
//
//        body.foo = undefined;
//        ok( $body.attr('foo') === undefined, 'Make sure the expando is preferred over the dom attribute, even if undefined' );
//
//        body.removeAttribute('foo'); // Cleanup
    };

    core1Suite.testAttr2 = function () {
        var equals = function(actual, expected, message) {
            Asserts.assertEqual(expected, actual, message);
        };

        equals( jQuery('#main').attr('nodeName').toUpperCase(), 'DIV', 'Check for nodeName attribute' );
        equals( jQuery('#main').attr('tagName').toUpperCase(), 'DIV', 'Check for tagName attribute' );
    };
    core1Suite.testAttr3 = function () {
        var equals = function(actual, expected, message) {
            Asserts.assertEqual(expected, actual, message);
        };

        equals( jQuery('#anchor').attr('href'), 'http://example.com/', 'Check for href attribute' );

        jQuery("#anchor").attr('href', 'http://bit.ly');
        // @todo fails :
        equals( jQuery('#anchor').attr('href'), "http://bit.ly/", 'Check modified href attribute' );

        // NOTE: not supportted by FBJS - changes it relative to canvas :
        jQuery("#anchor").attr('href', '#5');
        //equals( jQuery('#anchor').attr('href'), "#5", 'Check for non-absolute href (an anchor)' );
    };
    core1Suite.testAttrFunctionSetter = function () {
        var equals = function(actual, expected, message) {
            Asserts.assertEqual(expected, actual, message);
        };

        equals( jQuery('#text').attr('value', function() { return this.getId(); }).get(0).getValue(), "text", "Set value from id" );
        equals( jQuery('#text').attr('title', function(i) { return i; }).attr('title'), "0", "Set value with an index");
        
    };
    core1Suite.testAttrObjectSetter = function () {
        var pass = true;
        jQuery("span").attr({ title: 'foo', className: 'bar' });
        jQuery("span").each( function() {
            //console.log(this.getTitle(), this.getClassName());
            if ( this.getTitle() != "foo" && this.getClassName() != "bar" ) pass = false;
        });
        Asserts.assertTrue( pass, "Set Multiple Attributes" );
    };
    core1Suite.testAttrSetter = function () {
        var equals = function(actual, expected, message) {
            Asserts.assertEqual(expected, actual, message);
        };
        var ok = function(actual, message) {
            Asserts.assertTrue(actual, message);
        };

        equals( jQuery('#text').attr('value', function() { return this.getId(); }).get(0).getValue(), "text", "Set value from id" );

        var div = jQuery("div").attr("title", "bar");
        var fail = false;
        for ( var i = 0; i < div.size(); i++ ) {
            if ( div.get(i).getTitle() != "bar" ) { fail = i; break; }
        }
        equals( fail, false, "Set Attribute, the #"+ fail +" element didn't get the attribute 'foo'" );

        // @todo Support.attr() attribute name 'width' is not supported ?
        //ok( jQuery("#main").attr( { "width": null } ), "Try to set an attribute to nothing" );

        //jQuery("#main").attr('name', 'something');
        //equals( jQuery("#name").attr('name'), 'something', 'Set name attribute' );
        jQuery("#check").attr('checked', true);
        equals( document.getElementById('check').getChecked(), true, 'Set checked attribute' );
        jQuery("#check").attr('checked', false);
        equals( document.getElementById('check').getChecked(), false, 'Set checked attribute' );
        jQuery("#text").attr('readonly', true);
        equals( document.getElementById('text').getReadOnly(), true, 'Set readonly attribute' );
        jQuery("#text").attr('readonly', false);
        equals( document.getElementById('text').getReadOnly(), false, 'Set readonly attribute' );
        //jQuery("#name").attr('maxlength', '5');
        //equals( document.getElementById('name').maxLength, '5', 'Set maxlength attribute' );
        //jQuery("#name").attr('maxLength', '10');
        //equals( document.getElementById('name').maxLength, '10', 'Set maxlength attribute' );

        //jQuery("#name").attr('someAttr', '0');
        //equals( jQuery("#name").attr('someAttr'), '0', 'Set attribute to a string of "0"' );
        //jQuery("#name").attr('someAttr', 0);
        //equals( jQuery("#name").attr('someAttr'), 0, 'Set attribute to the number 0' );
        //jQuery("#name").attr('someAttr', 1);
        //equals( jQuery("#name").attr('someAttr'), 1, 'Set attribute to the number 1' );

        // using contents will get comments regular, text, and comment nodes
        //var j = jQuery("#nonnodes").contents();
        //j.attr("name", "attrvalue");
        //equals( j.attr("name"), "attrvalue", "Check node,textnode,comment for attr" );
        //j.removeAttr("name");

        var type = jQuery("#check").attr('type');
        var thrown = false;
        try { jQuery("#check").attr('type','hidden'); }
        catch (e) { thrown = true; }

        // @todo implement throwing error on changing as jQuery 1.3.2 did ?!
        //ok( thrown, "Exception thrown when trying to change type property" );
        //equals( type, jQuery("#check").attr('type'), "Verify that you can't change the type of an input element" );

        var check = document.createElement("input");
        var notThrown = true;
        try { jQuery(check).attr('type','checkbox'); }
        catch (e) { notThrown = false; }

        ok( notThrown, "Exception thrown when trying to change type property" );
        equals( "checkbox", jQuery(check).attr('type'), "Verify that you can change the type of an input element that isn't in the DOM" );

        var check = jQuery("<input />");
        var notThrown = true;
        try { check.attr('type','checkbox'); }
        catch (e) { notThrown = false; }
        
        ok( notThrown, "Exception thrown when trying to change type property" );
        equals( "checkbox", check.attr('type'), "Verify that you can change the type of an input element that isn't in the DOM" );
    };
</script>
